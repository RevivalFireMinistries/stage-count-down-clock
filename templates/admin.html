<!-- templates/admin.html - Mobile-First Redesign -->
<!DOCTYPE html>
<html>
<head>
    <title>Timer Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/admin.css" rel="stylesheet">
</head>
<body>
    <!-- Top Header -->
    <div class="mobile-header">
        <h1><i class="fas fa-clock"></i> Timer</h1>
        <a href="/kiosk" class="kiosk-btn" target="_blank">
            <i class="fas fa-tv"></i> Kiosk
        </a>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- Main Content Area -->
    <div class="content-wrapper">
        
        <!-- HOME TAB -->
        <div class="tab-content active" id="homeTab">
            <!-- Auto-Start Notification (shown when program is scheduled) -->
            <div class="card" id="autoStartCard" style="display: none; border-left: 4px solid #3498db; background: #e3f2fd;">
                <div class="card-body" style="padding: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 2rem; color: #3498db;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.25rem 0; color: #2c3e50;">
                                <i class="fas fa-calendar-check"></i> Auto-Start Scheduled
                            </h4>
                            <p id="autoStartMessage" style="margin: 0; color: #34495e; font-size: 0.95rem;">
                                Loading...
                            </p>
                            <p id="autoStartCountdown" style="margin: 0.5rem 0 0 0; font-weight: bold; color: #3498db; font-size: 1.1rem;">
                                <!-- Countdown will appear here -->
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timer Status Card -->
            <div class="status-card">
                <div class="status-header">
                    <span class="status-indicator status-stopped"></span>
                    <span id="statusText">STOPPED</span>
                </div>
                <div class="status-main">
                    <div class="activity-display">
                        <div class="activity-label">Current Activity</div>
                        <div class="activity-name" id="currentActivity">-</div>
                    </div>
                    <div class="time-display" id="timeRemaining">00:00</div>
                </div>
            </div>

            <!-- Quick Controls -->
            <div class="quick-controls">
                <button class="control-btn btn-start" onclick="startCurrentProgram()" id="startBtn">
                    <i class="fas fa-play"></i>
                    <span>Start</span>
                </button>
                <button class="control-btn btn-smart" onclick="startProgramSmart()" id="smartStartBtn">
                    <i class="fas fa-rocket"></i>
                    <span>Smart Start</span>
                </button>
                <button class="control-btn btn-pause" onclick="pauseTimer()" id="pauseBtn" disabled>
                    <i class="fas fa-pause"></i>
                    <span>Pause</span>
                </button>
                <button class="control-btn btn-resume" onclick="resumeTimer()" id="resumeBtn" disabled>
                    <i class="fas fa-play-circle"></i>
                    <span>Resume</span>
                </button>
                <button class="control-btn btn-next" onclick="nextItem()" id="nextBtn" disabled>
                    <i class="fas fa-forward"></i>
                    <span>Next</span>
                </button>
                <button class="control-btn btn-stop" onclick="stopTimer()" id="stopBtn" disabled>
                    <i class="fas fa-stop"></i>
                    <span>Stop</span>
                </button>
            </div>

            <!-- Current Program Card -->
            <div class="card">
                <div class="card-header" onclick="toggleCard(this)">
                    <h3><i class="fas fa-list-alt"></i> Current Program</h3>
                    <i class="fas fa-chevron-down toggle"></i>
                </div>
                <div class="card-body open">
                    <div id="currentProgramInfo">
                        <p class="empty-text">No program loaded</p>
                    </div>
                    <button class="btn btn-primary full-width" onclick="showProgramSelector()">
                        <i class="fas fa-folder-open"></i> Load Program
                    </button>
                    <button class="btn btn-secondary full-width" onclick="editCurrentProgram()" id="editCurrentProgramBtn" style="display: none; margin-top: 0.5rem;">
                        <i class="fas fa-edit"></i> Edit Program
                    </button>
                </div>
            </div>

            <!-- Live Schedule (when running) -->
            <div class="card" id="liveScheduleCard" style="display: none;">
                <div class="card-header" onclick="toggleCard(this)">
                    <h3><i class="fas fa-broadcast-tower"></i> Live Schedule</h3>
                    <i class="fas fa-chevron-down toggle"></i>
                </div>
                <div class="card-body open">
                    <p class="help-text"><i class="fas fa-info-circle"></i> Drag to reorder (temporary)</p>
                    <div id="liveScheduleList"></div>
                </div>
            </div>
        </div>

        <!-- PROGRAMS TAB -->
        <div class="tab-content" id="programsTab">
            <div class="tab-header">
                <h2>Programs</h2>
                <button class="btn btn-primary" onclick="showCreateProgramModal()">
                    <i class="fas fa-plus"></i> New
                </button>
            </div>
            <div class="list-container" id="programList">
                <!-- Programs loaded here -->
            </div>
        </div>

        <!-- ACTIVITIES TAB -->
        <div class="tab-content" id="activitiesTab">
            <div class="tab-header">
                <h2>Activities</h2>
                <button class="btn btn-primary" onclick="showCreateActivityModal()">
                    <i class="fas fa-plus"></i> New
                </button>
            </div>
            <div class="list-container" id="activityList">
                <!-- Activities loaded here -->
            </div>
        </div>

        <!-- SCHEDULE TAB -->
        <div class="tab-content" id="scheduleTab">
            <div class="tab-header">
                <h2>Program Schedule</h2>
                <button class="btn btn-primary" onclick="showAddActivityModal()" id="addActivityBtn">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>
            <div class="schedule-notice" id="scheduleNotice">
                <i class="fas fa-info-circle"></i>
                <p>Load a program first to view its schedule</p>
            </div>
            <div class="list-container" id="programSchedule">
                <!-- Schedule loaded here -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="switchTab('homeTab', this)">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </button>
        <button class="nav-btn" onclick="switchTab('programsTab', this)">
            <i class="fas fa-calendar-alt"></i>
            <span>Programs</span>
        </button>
        <button class="nav-btn" onclick="switchTab('activitiesTab', this)">
            <i class="fas fa-tasks"></i>
            <span>Activities</span>
        </button>
        <button class="nav-btn" onclick="switchTab('scheduleTab', this)">
            <i class="fas fa-clock"></i>
            <span>Schedule</span>
        </button>
    </nav>

    <!-- MODALS -->
    
    <!-- Program Selector Modal -->
    <div id="programSelectorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Program</h3>
                <button class="close-btn" onclick="closeModal('programSelectorModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="programSelectorList"></div>
            </div>
        </div>
    </div>

    <!-- Create Program Modal -->
    <div id="createProgramModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Program</h3>
                <button class="close-btn" onclick="closeModal('createProgramModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form onsubmit="createProgram(event)">
                    <div class="form-group">
                        <label>Program Name</label>
                        <input type="text" id="programName" class="form-input" required placeholder="Sunday Service">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="programDescription" class="form-input" rows="3" placeholder="Optional description"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Day of Week</label>
                        <select id="programDayOfWeek" class="form-input">
                            <option value="">Select a day</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                            <option value="Saturday">Saturday</option>
                            <option value="Sunday">Sunday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Start Time (24-hour)</label>
                        <input type="text" id="programStartTime" class="form-input" placeholder="09:30" pattern="[0-9]{2}:[0-9]{2}">
                        <small class="help-text">e.g., 09:30 or 14:00</small>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="programAutoStart">
                            <span>Auto-start on app launch</span>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary full-width">Create Program</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Program Modal -->
    <div id="editProgramModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Program</h3>
                <button class="close-btn" onclick="closeModal('editProgramModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form onsubmit="updateProgram(event)">
                    <input type="hidden" id="editProgramId">
                    <div class="form-group">
                        <label>Program Name</label>
                        <input type="text" id="editProgramName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="editProgramDescription" class="form-input" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Day of Week</label>
                        <select id="editProgramDayOfWeek" class="form-input">
                            <option value="">Select a day</option>
                            <option value="Monday">Monday</option>
                            <option value="Tuesday">Tuesday</option>
                            <option value="Wednesday">Wednesday</option>
                            <option value="Thursday">Thursday</option>
                            <option value="Friday">Friday</option>
                            <option value="Saturday">Saturday</option>
                            <option value="Sunday">Sunday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Start Time (24-hour)</label>
                        <input type="text" id="editProgramStartTime" class="form-input" placeholder="09:30" pattern="[0-9]{2}:[0-9]{2}">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="editProgramAutoStart">
                            <span>Auto-start on app launch</span>
                        </label>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-danger" onclick="deleteCurrentProgram()">Delete</button>
                    </div>
                </form>
                
                <!-- Activities Management Section -->
                <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e0e0e0;">
                <div style="margin-top: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="margin: 0;"><i class="fas fa-list"></i> Program Schedule</h4>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn btn-primary btn-sm" onclick="showCreateActivityFromProgram()">
                                <i class="fas fa-plus"></i> New Activity
                            </button>
                            <button type="button" class="btn btn-success btn-sm" onclick="showAddActivityFromProgram()">
                                <i class="fas fa-plus-circle"></i> Add Existing
                            </button>
                        </div>
                    </div>
                    <p class="help-text" style="margin-bottom: 1rem;">
                        <i class="fas fa-info-circle"></i> Manage activities in this program's schedule. Drag to reorder.
                    </p>
                    <div id="editProgramScheduleList" class="list-container" style="max-height: 300px; overflow-y: auto;">
                        <!-- Schedule items will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Activity Modal -->
    <div id="createActivityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Activity</h3>
                <button class="close-btn" onclick="closeModal('createActivityModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form onsubmit="createActivity(event)">
                    <div class="form-group">
                        <label>Activity Name</label>
                        <input type="text" id="activityName" class="form-input" required placeholder="Worship">
                    </div>
                    <div class="form-group">
                        <label>Default Duration (minutes)</label>
                        <input type="number" id="activityDuration" class="form-input" value="5" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="activityDescription" class="form-input" rows="3" placeholder="Optional description"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary full-width">Create Activity</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Activity to Schedule Modal -->
    <div id="addActivityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add to Schedule</h3>
                <button class="close-btn" onclick="closeModal('addActivityModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Activity</label>
                    <select id="activitySelect" class="form-input">
                        <!-- Activities populated here -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="scheduleActivityDuration" class="form-input" value="5" min="1" required>
                </div>
                <button class="btn btn-primary full-width" onclick="addActivityToSchedule()">Add to Schedule</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/sortablejs@1.14.0/Sortable.min.js"></script>
    <script src="/static/js/admin.js"></script>
    <script>
        // Tab switching function
        function switchTab(tabId, button) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            button.classList.add('active');
        }
        
        // Card collapse toggle
        function toggleCard(header) {
            header.classList.toggle('open');
            const body = header.nextElementSibling;
            body.classList.toggle('open');
        }
    </script>
</body>
</html>